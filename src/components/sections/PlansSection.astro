---
// PlansSection.astro
const plans = [
  {
    id: "pymes",
    label: "Pymes",
    title: "Control total para tu empresa",
    description:
      "Gestiona todas tus finanzas en tiempo real. Control y visibilidad total en tu negocio con múltiples usuarios y permisos personalizados.",
    image:
      "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?q=80&w=1000&auto=format&fit=crop",
    user: "Máximo De León",
    role: "Colaborador",
  },
  {
    id: "micro",
    label: "Microempresas",
    title: "Agilidad para equipos pequeños",
    description:
      "Simplifica la gestión diaria. Tarjetas para empleados, escaneo de facturas y contabilidad automatizada para crecer sin burocracia.",
    image:
      "https://images.unsplash.com/photo-1556761175-5973dc0f32e7?q=80&w=1000&auto=format&fit=crop",
    user: "Ana García",
    role: "Fundadora",
  },
  {
    id: "creacion",
    label: "Creación de empresa",
    title: "Empieza con el pie derecho",
    description:
      "Todo lo que necesitas para constituir tu sociedad. Depósito de capital online y certificado en 72 horas listo para el notario.",
    image:
      "https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?q=80&w=1000&auto=format&fit=crop",
    user: "Carlos Ruiz",
    role: "Socio único",
  },
  {
    id: "autonomos",
    label: "Autónomos",
    title: "Tu negocio en el bolsillo",
    description:
      "Separa tus finanzas personales de las profesionales. Una cuenta corriente con IBAN español y tarjeta Mastercard incluida.",
    image:
      "https://images.unsplash.com/photo-1519389950473-47ba0277781c?q=80&w=1000&auto=format&fit=crop",
    user: "Laura Vives",
    role: "Freelance",
  },
];
---

<section class="w-full bg-white py-24 px-4 font-sans">
  <div class="max-w-7xl mx-auto">
    <div class="text-center mb-20">
      <h2 class="text-3xl md:text-5xl font-medium tracking-tight text-gray-900">
        Planes para cada tipo de negocio
      </h2>
    </div>

    <div
      class="flex flex-col lg:flex-row items-center justify-between gap-12 lg:gap-20 min-h-[500px]"
    >
      <div
        class="w-full lg:w-1/4 flex flex-col items-start space-y-1 relative overflow-hidden"
      >
        {
          plans.map((plan, index) => (
            <button
              id={`tab-${index}`}
              class="plan-tab w-full cursor-pointer text-left py-2 text-xl md:text-xl font-medium  transition-all duration-300 outline-none focus:outline-none text-gray-400 hover:text-gray-600 hover:ml-4"
              data-index={index}
            >
              {plan.label}
            </button>
          ))
        }
      </div>

      <div class="w-full lg:w-1/3 relative h-[500px] perspective-1000 group">
        <div
          class="relative w-full h-full rounded-2xl overflow-hidden shadow-2xl transform transition-transform duration-500 hover:scale-[1.01]"
        >
          <img
            id="plan-image"
            src={plans[0].image}
            alt="Plan Image"
            class="w-full h-full object-cover transition-opacity duration-500"
          />
          <div class="absolute inset-0 bg-black/5"></div>
        </div>

        <div
          class="absolute top-8 -right-4 md:-right-8 bg-white p-3 rounded-xl shadow-lg flex items-center gap-3 animate-float-slow z-20 max-w-[200px]"
        >
          <img
            id="widget-avatar"
            src="https://randomuser.me/api/portraits/men/32.jpg"
            alt="User"
            class="w-10 h-10 rounded-full border-2 border-white shadow-sm"
          />
          <div class="flex flex-col">
            <span id="widget-user" class="text-xs font-bold text-gray-900"
              >{plans[0].user}</span
            >
            <span id="widget-role" class="text-[10px] text-gray-500"
              >{plans[0].role}</span
            >
          </div>
        </div>

        <div
          class="absolute bottom-12 -left-4 md:-left-8 bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-xl z-20 animate-float-reverse w-[260px]"
        >
          <div
            class="flex items-center gap-2 mb-3 text-gray-500 text-xs uppercase font-bold tracking-wider"
          >
            Límite mensual
          </div>
          <div class="flex justify-between gap-2">
            <span class="px-2 py-1 bg-gray-100 rounded text-xs text-gray-500"
              >250€</span
            >
            <span
              class="px-2 py-1 bg-gradient-to-r from-pink-600 to-orange-500 text-white rounded text-xs shadow"
              >2.000€</span
            >
            <span class="px-2 py-1 bg-gray-100 rounded text-xs text-gray-500"
              >Otro</span
            >
          </div>
        </div>
      </div>

      <div
        class="w-full lg:w-1/4 flex flex-col items-start justify-center h-full"
      >
        <div id="text-container" class="transition-opacity duration-300">
          <p
            id="plan-description"
            class="text-xl md:text-2xl text-gray-900 leading-relaxed font-light mb-8"
          >
            {plans[0].description}
          </p>
          <a
            href="#"
            class="group inline-flex items-center text-lg font-medium text-gray-900"
          >
            <span
              class="border-b border-gray-300 group-hover:border-pink-600 group-hover:text-pink-600 transition-colors duration-300"
              >Más información</span
            >
          </a>
        </div>
      </div>
    </div>

    <div class="mt-20 text-center">
      <a
        href="#"
        class="inline-block bg-black text-white px-10 py-4 rounded hover:bg-gray-800"
        >Encuentra tu plan</a
      >
    </div>
  </div>
</section>

<style>
  /* Animaciones */
  @keyframes float {
    0%,
    100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-8px);
    }
  }
  @keyframes float-reverse {
    0%,
    100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(6px);
    }
  }
  .animate-float-slow {
    animation: float 5s ease-in-out infinite;
  }
  .animate-float-reverse {
    animation: float-reverse 6s ease-in-out infinite;
  }
</style>

<script define:vars={{ plans }}>
  document.addEventListener("DOMContentLoaded", () => {
    // Referencias al DOM
    const planImage = document.getElementById("plan-image");
    const planDesc = document.getElementById("plan-description");
    const widgetUser = document.getElementById("widget-user");
    const widgetRole = document.getElementById("widget-role");
    const textContainer = document.getElementById("text-container");

    // Clases de Tailwind para los estados
    const activeClasses = ["ml-8", "border-black", "text-black", "border-b-2"];
    const inactiveClasses = [
      "text-gray-400",
      "hover:text-gray-600",
      "border-gray-200",
      "border-b",
    ];

    // Función: Pinta visualmente los Tabs
    function renderTabs(activeIndex) {
      plans.forEach((_, index) => {
        // Seleccionamos por ID
        const tab = document.getElementById(`tab-${index}`);

        if (!tab) return;

        if (index === activeIndex) {
          // Activar
          tab.classList.remove(...inactiveClasses);
          tab.classList.add(...activeClasses);
        } else {
          // Desactivar
          tab.classList.remove(...activeClasses);
          tab.classList.add(...inactiveClasses);
        }
      });
    }

    // Función: Actualiza el contenido (Texto/Imagen)
    function updateContent(index) {
      planImage.style.opacity = "0";
      textContainer.style.opacity = "0";

      setTimeout(() => {
        const data = plans[index];

        // Actualizar datos
        planImage.src = data.image;
        planDesc.innerText = data.description;
        widgetUser.innerText = data.user;
        widgetRole.innerText = data.role;

        // Fade in
        planImage.style.opacity = "1";
        textContainer.style.opacity = "1";
      }, 300);
    }

    // 1. ASIGNAR EVENT LISTENERS
    plans.forEach((_, index) => {
      const tab = document.getElementById(`tab-${index}`);
      if (tab) {
        tab.addEventListener("click", () => {
          renderTabs(index); // Cambia estilos del botón inmediatamente
          updateContent(index); // Cambia contenido con fade
        });
      }
    });

    // 2. INICIALIZAR EL ESTADO (Importante: Ejecutar al cargar)
    // Como el HTML viene "limpio" (todos grises), debemos activar el 0 manualmente aquí.
    renderTabs(0);
  });
</script>
